联合索引的一些经验
-----------------

### 交易记录的优化

- 昨天有一个新来的同事问我一个交易记录的语句怎么优化，一看，妈呀，扫描700W条目，再看语句本身，使用时间索引，没有可观的优化空间，只能从底层设计去考虑了；
那么问题来了，独立索引肯定满足不了这个业务的查询，该怎么建立联合索引呢？从结构上说，一般是建立time和account_type的udx，并且time最左前缀;然而得到的结果
却无变化。仔细分析后发现，time的切片本来就很大了，再加上account_type无济于事;这个时候就得空间换时间了，因为account_type的切片比较小，应该以account_type
作为最左前缀，实践发现效率提高了475倍。空间的牺牲是一回事，插入和更新的性能势必受到影响，只是不是很大，但量大的表，一定要全方位地考虑并测试，万一DB挂了就得不偿失；
所以，再次验证，经验法则在某些情况下是无用的。


```javascript

SELECT SQL_NO_CACHE id as trade_id,.... FROM t1
WHERE `time` BETWEEN '2017-06-01 00:00:00' AND '2017-08-17 10:06:55'
AND `type` IN (0,1,14,15,16,17,23,31,3,4,6,12,13,24,25,27,28,29,30,5,19,20,21,2,7,8,9,10,22,26,32)
AND `account_type` = '17' AND `money` > 0 ORDER BY time desc LIMIT 0,15

```